# Change Impact Tests

This document verifies the requirements for Reqvire's change impact tracing functionality.

## Change Impact Tracing Verification
```mermaid
graph LR;
  %% REQVIRE-AUTOGENERATED-DIAGRAM
  %% Graph styling
  classDef userRequirement fill:#f9d6d6,stroke:#f55f5f,stroke-width:1px;
  classDef systemRequirement fill:#fce4e4,stroke:#e68a8a,stroke-width:1px;
  classDef verification fill:#d6f9d6,stroke:#5fd75f,stroke-width:1px;
  classDef default fill:#f5f5f5,stroke:#333333,stroke-width:1px;

  b72d56e7e360fe6c["Change Impact Analysis Verification"];
  class b72d56e7e360fe6c verification;
  click b72d56e7e360fe6c "ChangeImpactTests.md#change-impact-analysis-verification";
  e95e3160edec8f1b["test.sh"];
  class e95e3160edec8f1b default;
  click e95e3160edec8f1b "../../tests/test-change-impact-detection/test.sh";
  b72d56e7e360fe6c -->|satisfiedBy| e95e3160edec8f1b;
  98d7b16583855bb7["Change Impact Detection Test"];
  class 98d7b16583855bb7 verification;
  click 98d7b16583855bb7 "ChangeImpactTests.md#change-impact-detection-test";
  e95e3160edec8f1b["test.sh"];
  class e95e3160edec8f1b default;
  click e95e3160edec8f1b "../../tests/test-change-impact-detection/test.sh";
  98d7b16583855bb7 -->|satisfiedBy| e95e3160edec8f1b;
  cec02a5e3f71bed1["Change Impact Relations Test"];
  class cec02a5e3f71bed1 verification;
  click cec02a5e3f71bed1 "ChangeImpactTests.md#change-impact-relations-test";
  e95e3160edec8f1b["test.sh"];
  class e95e3160edec8f1b default;
  click e95e3160edec8f1b "../../tests/test-change-impact-detection/test.sh";
  cec02a5e3f71bed1 -->|satisfiedBy| e95e3160edec8f1b;
  4f17266696162a10["Change Impact Smart Filtering Test"];
  class 4f17266696162a10 verification;
  click 4f17266696162a10 "ChangeImpactTests.md#change-impact-smart-filtering-test";
  6cc7cc8a3f2af10b["test.sh"];
  class 6cc7cc8a3f2af10b default;
  click 6cc7cc8a3f2af10b "../../tests/test-change-impact-smart-filtering/test.sh";
  4f17266696162a10 -->|satisfiedBy| 6cc7cc8a3f2af10b;
  893e340d64ec8044["CLI Git Commit Hash Flag Test"];
  class 893e340d64ec8044 verification;
  click 893e340d64ec8044 "ChangeImpactTests.md#cli-git-commit-hash-flag-test";
  e95e3160edec8f1b["test.sh"];
  class e95e3160edec8f1b default;
  click e95e3160edec8f1b "../../tests/test-change-impact-detection/test.sh";
  893e340d64ec8044 -->|satisfiedBy| e95e3160edec8f1b;
  a4090fe7e30eeae4["Element Content Extraction Test"];
  class a4090fe7e30eeae4 verification;
  click a4090fe7e30eeae4 "ChangeImpactTests.md#element-content-extraction-test";
  c287b52ceb52aa04["test.sh"];
  class c287b52ceb52aa04 default;
  click c287b52ceb52aa04 "../../tests/test-element-content-extraction/test.sh";
  a4090fe7e30eeae4 -->|satisfiedBy| c287b52ceb52aa04;
  b0e8adb6596a35e7["Structural Change Reports Verification"];
  class b0e8adb6596a35e7 verification;
  click b0e8adb6596a35e7 "ChangeImpactTests.md#structural-change-reports-verification";
  e95e3160edec8f1b["test.sh"];
  class e95e3160edec8f1b default;
  click e95e3160edec8f1b "../../tests/test-change-impact-detection/test.sh";
  b0e8adb6596a35e7 -->|satisfiedBy| e95e3160edec8f1b;
  11c3285e74c8d60b["Traceability Matrix Verification"];
  class 11c3285e74c8d60b verification;
  click 11c3285e74c8d60b "ChangeImpactTests.md#traceability-matrix-verification";
  e95e3160edec8f1b["test.sh"];
  class e95e3160edec8f1b default;
  click e95e3160edec8f1b "../../tests/test-change-impact-detection/test.sh";
  11c3285e74c8d60b -->|satisfiedBy| e95e3160edec8f1b;
  2316dac9e73bfda0["Change Impact Command Line Interface"];
  class 2316dac9e73bfda0 systemRequirement;
  click 2316dac9e73bfda0 "../ReqvireTool/ModelManagement/ChangeImpact.md#change-impact-command-line-interface";
  80defdd4cbc7ee18["cli.rs"];
  class 80defdd4cbc7ee18 default;
  click 80defdd4cbc7ee18 "../../cli/src/cli.rs";
  2316dac9e73bfda0 -->|satisfiedBy| 80defdd4cbc7ee18;
  2316dac9e73bfda0 -.->|verifiedBy| 98d7b16583855bb7;
  2316dac9e73bfda0 -.->|verifiedBy| cec02a5e3f71bed1;
  16b284f882a920cc["Change Impact Detection Algorithm"];
  class 16b284f882a920cc systemRequirement;
  click 16b284f882a920cc "../ReqvireTool/ModelManagement/ChangeImpact.md#change-impact-detection-algorithm";
  4b89dbed94c08c3e["change_impact.rs"];
  class 4b89dbed94c08c3e default;
  click 4b89dbed94c08c3e "../../core/src/change_impact.rs";
  16b284f882a920cc -->|satisfiedBy| 4b89dbed94c08c3e;
  16b284f882a920cc -.->|verifiedBy| 98d7b16583855bb7;
  16b284f882a920cc -.->|verifiedBy| cec02a5e3f71bed1;
  16b284f882a920cc -.->|verifiedBy| a4090fe7e30eeae4;
  674e6f27f5fda615["Change Impact Visualization"];
  class 674e6f27f5fda615 systemRequirement;
  click 674e6f27f5fda615 "../ReqvireTool/ModelManagement/ChangeImpact.md#change-impact-visualization";
  4b89dbed94c08c3e["change_impact.rs"];
  class 4b89dbed94c08c3e default;
  click 4b89dbed94c08c3e "../../core/src/change_impact.rs";
  674e6f27f5fda615 -->|satisfiedBy| 4b89dbed94c08c3e;
  674e6f27f5fda615 -.->|verifiedBy| 98d7b16583855bb7;
  5d60cdc1fa8c4bac["Smart Filtering for Change Impact Reports"];
  class 5d60cdc1fa8c4bac systemRequirement;
  click 5d60cdc1fa8c4bac "../ReqvireTool/ModelManagement/ChangeImpact.md#smart-filtering-for-change-impact-reports";
  4b89dbed94c08c3e["change_impact.rs"];
  class 4b89dbed94c08c3e default;
  click 4b89dbed94c08c3e "../../core/src/change_impact.rs";
  5d60cdc1fa8c4bac -->|satisfiedBy| 4b89dbed94c08c3e;
  5d60cdc1fa8c4bac -.->|verifiedBy| 98d7b16583855bb7;
  5d60cdc1fa8c4bac -.->|verifiedBy| 4f17266696162a10;
  45f9231a94c04f4e["Requirements Processing"];
  class 45f9231a94c04f4e systemRequirement;
  click 45f9231a94c04f4e "../ReqvireTool/Storage/Configuration.md#requirements-processing";
  8e563a19dae4183b["Structured Markdown Files Search and Detection"];
  class 8e563a19dae4183b systemRequirement;
  click 8e563a19dae4183b "../ReqvireTool/Storage/Configuration.md#structured-markdown-files-search-and-detection";
  45f9231a94c04f4e -.->|deriveReqT| 8e563a19dae4183b;
  e1d08514a32ae308["GraphRegistry as Primary Registry"];
  class e1d08514a32ae308 systemRequirement;
  click e1d08514a32ae308 "../ReqvireTool/ValidationAndReporting/Validation.md#graphregistry-as-primary-registry";
  45f9231a94c04f4e -.->|deriveReqT| e1d08514a32ae308;
  6f1d7610c2419511["Two-Pass Validation Strategy"];
  class 6f1d7610c2419511 systemRequirement;
  click 6f1d7610c2419511 "../ReqvireTool/ValidationAndReporting/Validation.md#two-pass-validation-strategy";
  45f9231a94c04f4e -.->|deriveReqT| 6f1d7610c2419511;
  d50a859650933e55["model.rs"];
  class d50a859650933e55 default;
  click d50a859650933e55 "../../core/src/model.rs";
  45f9231a94c04f4e -->|satisfiedBy| d50a859650933e55;
  f22d93285fcd7664["parser.rs"];
  class f22d93285fcd7664 default;
  click f22d93285fcd7664 "../../core/src/parser.rs";
  45f9231a94c04f4e -->|satisfiedBy| f22d93285fcd7664;
  45f9231a94c04f4e -.->|verifiedBy| a4090fe7e30eeae4;
  6ca2ff1567644e78["Same-File Fragment Relations Test"];
  class 6ca2ff1567644e78 verification;
  click 6ca2ff1567644e78 "ValidationTests.md#same-file-fragment-relations-test";
  45f9231a94c04f4e -.->|verifiedBy| 6ca2ff1567644e78;
  a19b7b8063d130c5["CLI Git Commit Hash Flag"];
  class a19b7b8063d130c5 systemRequirement;
  click a19b7b8063d130c5 "../ReqvireTool/UserInterface/CLI.md#cli-git-commit-hash-flag";
  80defdd4cbc7ee18["cli.rs"];
  class 80defdd4cbc7ee18 default;
  click 80defdd4cbc7ee18 "../../cli/src/cli.rs";
  a19b7b8063d130c5 -->|satisfiedBy| 80defdd4cbc7ee18;
  a19b7b8063d130c5 -.->|verifiedBy| 893e340d64ec8044;
  9933cac5853a8584["Change Impact Analysis"];
  class 9933cac5853a8584 userRequirement;
  click 9933cac5853a8584 "../UserRequirements.md#change-impact-analysis";
  2054606d7574a553["Requirements Change Propagation"];
  class 2054606d7574a553 systemRequirement;
  click 2054606d7574a553 "../SpecificationsRequirements.md#requirements-change-propagation";
  9933cac5853a8584 -.->|deriveReqT| 2054606d7574a553;
  9933cac5853a8584 -.->|verifiedBy| b72d56e7e360fe6c;
  4e30ea0930dc9c26["Traceability Matrix"];
  class 4e30ea0930dc9c26 userRequirement;
  click 4e30ea0930dc9c26 "../UserRequirements.md#traceability-matrix";
  c02a614c9331efc2["Markdown Matrix Formatter"];
  class c02a614c9331efc2 systemRequirement;
  click c02a614c9331efc2 "../ReqvireTool/ModelManagement/TraceabilityMatrix.md#markdown-matrix-formatter";
  4e30ea0930dc9c26 -.->|deriveReqT| c02a614c9331efc2;
  66ef5ed834d0b401["Traceability Matrix Builder Implementation"];
  class 66ef5ed834d0b401 systemRequirement;
  click 66ef5ed834d0b401 "../ReqvireTool/ModelManagement/TraceabilityMatrix.md#traceability-matrix-builder-implementation";
  4e30ea0930dc9c26 -.->|deriveReqT| 66ef5ed834d0b401;
  7de9a55d6102af23["Export Traceability Matrix"];
  class 7de9a55d6102af23 userRequirement;
  click 7de9a55d6102af23 "../UserRequirements.md#export-traceability-matrix";
  4e30ea0930dc9c26 -.->|deriveReqT| 7de9a55d6102af23;
  6d32b919c82784b7["Include Verification Checkboxes"];
  class 6d32b919c82784b7 userRequirement;
  click 6d32b919c82784b7 "../UserRequirements.md#include-verification-checkboxes";
  4e30ea0930dc9c26 -.->|deriveReqT| 6d32b919c82784b7;
  4e30ea0930dc9c26 -.->|verifiedBy| 11c3285e74c8d60b;
  d7b7b13a5b8d96e1["Tracing Structural Changes"];
  class d7b7b13a5b8d96e1 userRequirement;
  click d7b7b13a5b8d96e1 "../UserRequirements.md#tracing-structural-changes";
  8d18a6def935ccdc["Structural Change Analyzer"];
  class 8d18a6def935ccdc systemRequirement;
  click 8d18a6def935ccdc "../ReqvireTool/ModelManagement/ChangeImpact.md#structural-change-analyzer";
  d7b7b13a5b8d96e1 -.->|deriveReqT| 8d18a6def935ccdc;
  d7b7b13a5b8d96e1 -.->|verifiedBy| b0e8adb6596a35e7;
```
### Change Impact Detection Test

This test verifies that the system correctly implements change impact detection, including proper default handling of the git commit parameter and smart filtering.

#### Details

##### Acceptance Criteria
- System correctly detects changes between different versions of requirements
- System properly constructs a change impact report based on relationships between elements
- Default git commit is HEAD when --git-commit parameter is not provided
- System provides output in both human-readable text and JSON formats
- Smart filtering removes redundant elements that appear in other elements' relations

##### Test Criteria
- Command exits with success (0) return code
- Change impact report shows expected elements
- Change impact report shows correct relationships between elements
- Changed elements referenced in other changed elements' relations are filtered out (e.g., "Power Saving" filtered when referenced by "Power Saving Mode")
- Output format matches requested format (text or JSON)
- Both explicit and implicit git commit parameters work properly
- JSON output is valid and contains all necessary information
- GitHub-style blob URLs are included in the output

#### Metadata
  * type: test-verification

#### Relations
  * verify: [Change Impact Detection Algorithm](../ReqvireTool/ModelManagement/ChangeImpact.md#change-impact-detection-algorithm)
  * verify: [Change Impact Command Line Interface](../ReqvireTool/ModelManagement/ChangeImpact.md#change-impact-command-line-interface)
  * verify: [Smart Filtering for Change Impact Reports](../ReqvireTool/ModelManagement/ChangeImpact.md#smart-filtering-for-change-impact-reports)
  * satisfiedBy: [test.sh](../../tests/test-change-impact-detection/test.sh)
---

### Change Impact Relations Test

This test verifies that the system correctly handles different relation types when calculating change impact.

#### Details

##### Acceptance Criteria
- System correctly propagates changes through different relation types
- System respects the IMPACT_PROPAGATION_RELATIONS list when determining impact flow
- System handles complex chains of relations properly

##### Test Criteria
- Command exits with success (0) return code
- Change impact report shows expected propagation through derivedFrom/derive relations
- Change impact report shows expected propagation through satisfiedBy/satisfy relations
- Change impact report shows expected propagation through verifiedBy/verify relations
- System correctly handles circular dependencies in relation chains

#### Metadata
  * type: test-verification

#### Relations
  * verify: [Change Impact Detection Algorithm](../ReqvireTool/ModelManagement/ChangeImpact.md#change-impact-detection-algorithm)
  * verify: [Change Impact Command Line Interface](../ReqvireTool/ModelManagement/ChangeImpact.md#change-impact-command-line-interface)
  * satisfiedBy: [test.sh](../../tests/test-change-impact-detection/test.sh)
---

### CLI Git Commit Hash Flag Test

This test verifies that the system properly handles the git commit hash flag for change impact analysis.

#### Details

##### Acceptance Criteria
- System shall support --git-commit flag for change impact analysis
- System shall use specified commit hash as base for comparison
- System shall default to HEAD when flag is not specified
- System shall handle relative commit references (HEAD~1, etc.)

##### Test Criteria
- Command with explicit --git-commit flag runs successfully
- Command without flag defaults to HEAD commit
- Relative commit references are correctly resolved
- Invalid commit references are reported appropriately
- Change impact analysis correctly uses specified commit as baseline

##### Test Procedure
1. Create test fixtures with git repository containing multiple commits
2. Run Reqvire with --change-impact --git-commit=HEAD~1
3. Verify that the specified commit is used as baseline
4. Run Reqvire with --change-impact (no git-commit flag)
5. Verify that HEAD is used as default baseline
6. Run with invalid commit reference and verify appropriate error

#### Metadata
  * type: test-verification

#### Relations
  * verify: [CLI Git Commit Hash Flag](../ReqvireTool/UserInterface/CLI.md#cli-git-commit-hash-flag)
  * satisfiedBy: [test.sh](../../tests/test-change-impact-detection/test.sh)
---

### Element Content Extraction Test

This test verifies that the system correctly extracts element content for change impact detection.

#### Details

##### Acceptance Criteria
- System should properly extract requirement body for change impact detection
- Requirement body should include normalized main text and content from the Details subsection
- System should handle requirements with various combinations of subsections

##### Test Criteria
- Command exits with success (0) return code
- Output shows expected content for each element
- Content extraction correctly handles different subsection ordering
- Content extraction properly handles HTML details tags

##### Test Procedure
1. Create test fixtures with requirements containing various combinations of subsections
2. Run Reqvire model summary on the test fixtures
3. Verify that extracted content matches expected content for each element
4. Verify that content from Details subsection is properly included

#### Metadata
  * type: test-verification

#### Relations
  * verify: [Change Impact Detection Algorithm](../ReqvireTool/ModelManagement/ChangeImpact.md#change-impact-detection-algorithm)
  * verify: [Requirements Processing](../ReqvireTool/Storage/Configuration.md#requirements-processing)
  * satisfiedBy: [test.sh](../../tests/test-element-content-extraction/test.sh)
---

### Change Impact Analysis Verification

This test verifies that the system generates change impact reports when requested.

#### Details

##### Acceptance Criteria
- System should generate change impact reports in Markdown format
- System should support JSON output for change impact reports
- Reports should include an overview of model changes and their impact

##### Test Criteria
- Command exits with success (0) return code
- Reports contain expected impact information
- Both Markdown and JSON formats are properly supported

##### Test Procedure
TODO: write test procedure

#### Metadata
  * type: test-verification

#### Relations
  * verify: [Change Impact Analysis](../UserRequirements.md#change-impact-analysis)
  * satisfiedBy: [test.sh](../../tests/test-change-impact-detection/test.sh)
---

### Traceability Matrix Verification

This test verifies that the system generates traceability matrices in Markdown format.

#### Details

##### Acceptance Criteria
- System should generate traceability matrices in Markdown format
- Matrices should support different views (Requirements-to-Verification, etc.)
- Matrices should efficiently represent relationships between elements

##### Test Criteria
- Command exits with success (0) return code
- Generated matrices contain expected relationship information
- Different matrix views are properly supported

##### Test Procedure
TODO: write test procedure

#### Metadata
  * type: test-verification

#### Relations
  * verify: [Traceability Matrix](../UserRequirements.md#traceability-matrix)
  * satisfiedBy: [test.sh](../../tests/test-change-impact-detection/test.sh)
---

### Structural Change Reports Verification

This test verifies that the system analyzes and reports on structural changes in the MBSE model.

#### Details

##### Acceptance Criteria
- System should analyze structural changes in the MBSE model
- System should identify affected components through relationship traversal
- System should generate reports of impacted elements and structures

##### Test Criteria
- Command exits with success (0) return code
- Change reports correctly identify affected elements
- Relationship traversal properly determines impact propagation

##### Test Procedure
TODO: write test procedure

#### Metadata
  * type: test-verification

#### Relations
  * verify: [Tracing Structural Changes](../UserRequirements.md#tracing-structural-changes)
  * satisfiedBy: [test.sh](../../tests/test-change-impact-detection/test.sh)
---

### Change Impact Smart Filtering Test

This test verifies that the smart filtering correctly handles new elements in change impact reports, filtering child elements while showing parent elements.

#### Details

##### Acceptance Criteria
- New parent elements appear in the "New Elements" section
- New child elements (with parent relationships to other new elements) are filtered out
- Filtered child elements are shown in parent's relations with "(new)" marker
- Verification elements that are not children remain in the report

##### Test Criteria
- When adding a parent and child requirement together, only parent appears in "New Elements"
- When adding a requirement and its verification, both appear (verification is not a child)
- Child elements are visible in the parent's change impact tree with appropriate markers

##### Test Procedure
1. Create test repository with existing requirements
2. Add new parent requirement with derive relation to new child requirement
3. Add new child requirement with derivedFrom relation to parent
4. Run change impact detection
5. Verify only parent appears in "New Elements" section
6. Verify child appears in parent's relations with "(new)" marker

#### Metadata
  * type: test-verification

#### Relations
  * verify: [Smart Filtering for Change Impact Reports](../ReqvireTool/ModelManagement/ChangeImpact.md#smart-filtering-for-change-impact-reports)
  * satisfiedBy: [test.sh](../../tests/test-change-impact-smart-filtering/test.sh)
---