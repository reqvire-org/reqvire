# Miscellaneous Verifications

This document contains miscellaneous verification tests that don't fit into the other verification categories.

## Export and Context Verifications
```mermaid
graph LR;
  %% REQVIRE-AUTOGENERATED-DIAGRAM
  %% Graph styling
  classDef requirement fill:#f9d6d6,stroke:#f55f5f,stroke-width:1px;
  classDef verification fill:#d6f9d6,stroke:#5fd75f,stroke-width:1px;
  classDef externalLink fill:#d0e0ff,stroke:#3080ff,stroke-width:1px;
  classDef default fill:#f5f5f5,stroke:#333333,stroke-width:1px;

  735766802775ec41["Format Command Requirements Verification"];
  class 735766802775ec41 verification;
  click 735766802775ec41 "Misc.md#format-command-requirements-verification";
  eaf33ce1e6113c8a["test.sh"];
  class eaf33ce1e6113c8a default;
  click eaf33ce1e6113c8a "../../tests/test-advanced-format/test.sh";
  735766802775ec41 -->|satisfiedBy| eaf33ce1e6113c8a;
  14ef985b9a43174e["HTML Export Verification"];
  class 14ef985b9a43174e verification;
  click 14ef985b9a43174e "Misc.md#html-export-verification";
  8899a52ea9866d8b["test.sh"];
  class 8899a52ea9866d8b default;
  click 8899a52ea9866d8b "../../tests/test-html-export/test.sh";
  14ef985b9a43174e -->|satisfiedBy| 8899a52ea9866d8b;
  9f473f6e0b993cac["Excess Whitespace Linting Implementation"];
  class 9f473f6e0b993cac requirement;
  click 9f473f6e0b993cac "../SystemRequirements/Requirements.md#excess-whitespace-linting-implementation";
  8fbf4ca0471377ea["format.rs"];
  class 8fbf4ca0471377ea default;
  click 8fbf4ca0471377ea "../../core/src/format.rs";
  9f473f6e0b993cac -->|satisfiedBy| 8fbf4ca0471377ea;
  9f473f6e0b993cac -.->|verifiedBy| 735766802775ec41;
  84b3d0502132adb5["Documentation Index HTML Integration"];
  class 84b3d0502132adb5 requirement;
  click 84b3d0502132adb5 "../UserRequirements.md#documentation-index-html-integration";
  84b3d0502132adb5 -.->|verifiedBy| 14ef985b9a43174e;
  c1851df0c89e80f8["HTML Navigation Enhancement"];
  class c1851df0c89e80f8 requirement;
  click c1851df0c89e80f8 "../SystemRequirements/Requirements.md#html-navigation-enhancement";
  84b3d0502132adb5 -.->|deriveReqT| c1851df0c89e80f8;
  47401bd64e231632["Parallel Linting Processing"];
  class 47401bd64e231632 requirement;
  click 47401bd64e231632 "../SystemRequirements/Requirements.md#parallel-linting-processing";
  8fbf4ca0471377ea["format.rs"];
  class 8fbf4ca0471377ea default;
  click 8fbf4ca0471377ea "../../core/src/format.rs";
  47401bd64e231632 -->|satisfiedBy| 8fbf4ca0471377ea;
  47401bd64e231632 -.->|verifiedBy| 735766802775ec41;
  837782fd5fe407a0["Document Structure Normalization"];
  class 837782fd5fe407a0 requirement;
  click 837782fd5fe407a0 "../SystemRequirements/Requirements.md#document-structure-normalization";
  b7c871ab64a7059a["graph_registry.rs"];
  class b7c871ab64a7059a default;
  click b7c871ab64a7059a "../../core/src/graph_registry.rs";
  837782fd5fe407a0 -->|satisfiedBy| b7c871ab64a7059a;
  f22d93285fcd7664["parser.rs"];
  class f22d93285fcd7664 default;
  click f22d93285fcd7664 "../../core/src/parser.rs";
  837782fd5fe407a0 -->|satisfiedBy| f22d93285fcd7664;
  837782fd5fe407a0 -.->|verifiedBy| 735766802775ec41;
  b7dd9db7a1290b97["Git-Style Diff Output for Linting"];
  class b7dd9db7a1290b97 requirement;
  click b7dd9db7a1290b97 "../SystemRequirements/Requirements.md#git-style-diff-output-for-linting";
  8fbf4ca0471377ea["format.rs"];
  class 8fbf4ca0471377ea default;
  click 8fbf4ca0471377ea "../../core/src/format.rs";
  b7dd9db7a1290b97 -->|satisfiedBy| 8fbf4ca0471377ea;
  b7dd9db7a1290b97 -.->|verifiedBy| 735766802775ec41;
  a7bd845c64d1685e["Reserved Subsections Linting Implementation"];
  class a7bd845c64d1685e requirement;
  click a7bd845c64d1685e "../SystemRequirements/Requirements.md#reserved-subsections-linting-implementation";
  8fbf4ca0471377ea["format.rs"];
  class 8fbf4ca0471377ea default;
  click 8fbf4ca0471377ea "../../core/src/format.rs";
  a7bd845c64d1685e -->|satisfiedBy| 8fbf4ca0471377ea;
  a7bd845c64d1685e -.->|verifiedBy| 735766802775ec41;
  8dfe33c28555e80a["Replace Absolute Links with Relative Links"];
  class 8dfe33c28555e80a requirement;
  click 8dfe33c28555e80a "../UserRequirements.md#replace-absolute-links-with-relative-links";
  8dfe33c28555e80a -.->|verifiedBy| 735766802775ec41;
  7d44a9de72f2ed11["Incosistent Newlines Linting Implementation"];
  class 7d44a9de72f2ed11 requirement;
  click 7d44a9de72f2ed11 "../SystemRequirements/Requirements.md#incosistent-newlines-linting-implementation";
  8fbf4ca0471377ea["format.rs"];
  class 8fbf4ca0471377ea default;
  click 8fbf4ca0471377ea "../../core/src/format.rs";
  7d44a9de72f2ed11 -->|satisfiedBy| 8fbf4ca0471377ea;
  7d44a9de72f2ed11 -.->|verifiedBy| 735766802775ec41;
  a4c40962cac85d0c["Export HTML specifications"];
  class a4c40962cac85d0c requirement;
  click a4c40962cac85d0c "../UserRequirements.md#export-html-specifications";
  a4c40962cac85d0c -.->|verifiedBy| 14ef985b9a43174e;
  5deb63503bdf77c["HTML Export"];
  class 5deb63503bdf77c requirement;
  click 5deb63503bdf77c "../SystemRequirements/Requirements.md#html-export";
  a4c40962cac85d0c -.->|deriveReqT| 5deb63503bdf77c;
  b49d890e0bbe0a83["Structure of Markdown Documents"];
  class b49d890e0bbe0a83 requirement;
  click b49d890e0bbe0a83 "../SpecificationsRequirements.md#structure-of-markdown-documents";
  9450d4313f47ef36["relation.rs"];
  class 9450d4313f47ef36 default;
  click 9450d4313f47ef36 "../../core/src/relation.rs";
  b49d890e0bbe0a83 -->|satisfiedBy| 9450d4313f47ef36;
  a814c4935e1a0449["element.rs"];
  class a814c4935e1a0449 default;
  click a814c4935e1a0449 "../../core/src/element.rs";
  b49d890e0bbe0a83 -->|satisfiedBy| a814c4935e1a0449;
  398003c91b6b2cde["subsection.rs"];
  class 398003c91b6b2cde default;
  click 398003c91b6b2cde "../../core/src/subsection.rs";
  b49d890e0bbe0a83 -->|satisfiedBy| 398003c91b6b2cde;
  f22d93285fcd7664["parser.rs"];
  class f22d93285fcd7664 default;
  click f22d93285fcd7664 "../../core/src/parser.rs";
  b49d890e0bbe0a83 -->|satisfiedBy| f22d93285fcd7664;
  d50a859650933e55["model.rs"];
  class d50a859650933e55 default;
  click d50a859650933e55 "../../core/src/model.rs";
  b49d890e0bbe0a83 -->|satisfiedBy| d50a859650933e55;
  b0d0999636b025fa["Invalid Header Structure Test"];
  class b0d0999636b025fa verification;
  click b0d0999636b025fa "ValidationTests.md#invalid-header-structure-test";
  b49d890e0bbe0a83 -.->|verifiedBy| b0d0999636b025fa;
  b49d890e0bbe0a83 -.->|verifiedBy| 735766802775ec41;
  c9988cdcfdea77a["Formatting Output"];
  class c9988cdcfdea77a requirement;
  click c9988cdcfdea77a "../UserRequirements.md#formatting-output";
  c9988cdcfdea77a -.->|deriveReqT| b7dd9db7a1290b97;
  c9988cdcfdea77a -.->|verifiedBy| 735766802775ec41;
  719bf8b75772947d["Missing Separators Linting Implementation"];
  class 719bf8b75772947d requirement;
  click 719bf8b75772947d "../SystemRequirements/Requirements.md#missing-separators-linting-implementation";
  8fbf4ca0471377ea["format.rs"];
  class 8fbf4ca0471377ea default;
  click 8fbf4ca0471377ea "../../core/src/format.rs";
  719bf8b75772947d -->|satisfiedBy| 8fbf4ca0471377ea;
  719bf8b75772947d -.->|verifiedBy| 735766802775ec41;
  875f89a9f301fb90["Format Command"];
  class 875f89a9f301fb90 requirement;
  click 875f89a9f301fb90 "../SystemRequirements/Requirements.md#format-command";
  80defdd4cbc7ee18["cli.rs"];
  class 80defdd4cbc7ee18 default;
  click 80defdd4cbc7ee18 "../../cli/src/cli.rs";
  875f89a9f301fb90 -->|satisfiedBy| 80defdd4cbc7ee18;
  875f89a9f301fb90 -.->|verifiedBy| 735766802775ec41;
  d0e6cc47b904faa5["html.rs"];
  class d0e6cc47b904faa5 default;
  click d0e6cc47b904faa5 "../../core/src/html.rs";
  c1851df0c89e80f8 -->|satisfiedBy| d0e6cc47b904faa5;
  c3d63c5d4133e346["html_export.rs"];
  class c3d63c5d4133e346 default;
  click c3d63c5d4133e346 "../../core/src/html_export.rs";
  c1851df0c89e80f8 -->|satisfiedBy| c3d63c5d4133e346;
  c1851df0c89e80f8 -.->|verifiedBy| 14ef985b9a43174e;
  8903fde565a36e15["Model Formatting"];
  class 8903fde565a36e15 requirement;
  click 8903fde565a36e15 "../UserRequirements.md#model-formatting";
  8903fde565a36e15 -.->|deriveReqT| 47401bd64e231632;
  b60a76b4bf328484["Formatting Command"];
  class b60a76b4bf328484 requirement;
  click b60a76b4bf328484 "../UserRequirements.md#formatting-command";
  8903fde565a36e15 -.->|deriveReqT| b60a76b4bf328484;
  8903fde565a36e15 -.->|deriveReqT| 8dfe33c28555e80a;
  8903fde565a36e15 -.->|verifiedBy| 735766802775ec41;
  974ccf933675ef44["Format Consistency Enforcement"];
  class 974ccf933675ef44 requirement;
  click 974ccf933675ef44 "../UserRequirements.md#format-consistency-enforcement";
  8903fde565a36e15 -.->|deriveReqT| 974ccf933675ef44;
  974ccf933675ef44 -.->|deriveReqT| 9f473f6e0b993cac;
  974ccf933675ef44 -.->|deriveReqT| 837782fd5fe407a0;
  974ccf933675ef44 -.->|deriveReqT| a7bd845c64d1685e;
  974ccf933675ef44 -.->|deriveReqT| 7d44a9de72f2ed11;
  974ccf933675ef44 -.->|deriveReqT| 719bf8b75772947d;
  974ccf933675ef44 -.->|verifiedBy| 735766802775ec41;
```
### HTML Export Verification

This test verifies that the system exports specifications into HTML format and saves them in the designated output location.

#### Details

##### Acceptance Criteria:
- System should export specifications to HTML format
- HTML files should be saved in the designated output location
- HTML output should maintain the structure and content of the original specifications
- SpecificationIndex.md should be renamed to index.html in output
- Links in diagrams and text must be converted to use .html instead of .md
- Paths in HTML files should maintain the original relative structure
- System should work in environments without Git repositories

##### Test Criteria:
- Command exits with success (0) return code
- HTML files are generated at the expected location with .html extension
- SpecificationIndex.md is converted to index.html
- HTML content preserves the structure and information from the source files
- Links in HTML files use .html extension instead of .md
- Mermaid click links are properly converted from .md to .html
- Both GitHub-style URLs and direct file paths in mermaid click links are handled correctly
- Paths should not have duplicated folder names (e.g., specifications/specifications)

#### Metadata
  * type: test-verification

#### Relations
  * verify: [Export HTML specifications](../UserRequirements.md#export-html-specifications)
  * satisfiedBy: [test.sh](../../tests/test-html-export/test.sh)
---

### Format Command Requirements Verification

This test verifies the format command requirements from SystemRequirements and UserRequirements, focusing on normalizing and standardizing MBSE models for consistency and readability.

#### Details

##### Acceptance Criteria
**Format Command Functionality:**
- System shall provide format command that normalizes and standardizes markdown documents
- System shall support --dry-run flag to preview changes without applying them
- System shall display changes in git diff style with line numbers and colors
- System shall show diff output when applying formatting changes (not only in dry-run mode)
- System shall support --json flag for structured output of formatting results
- System shall preserve all document content while improving formatting consistency

**Content Preservation:**
- System shall preserve personas sections and other non-element content
- System shall maintain element ordering within sections
- System shall preserve section ordering throughout documents
- System shall preserve page content (frontmatter before first section)
- System shall preserve section content (content between section headers and first element)

**Formatting Consistency:**
- System shall trim excess whitespace from lines
- System shall normalize line endings consistently
- System shall insert proper separators between elements
- System shall normalize consecutive separators to single separators
- System shall normalize relation indentation to proper 2-space format
- System shall format relation links with human-readable names
- System shall clean up file references to show filename only for implementation files

**Document Structure Normalization:**
- System shall add level 1 page header (based on filename) when document lacks page header
- System shall add `## Requirements` section header when elements exist without section header
- System shall preserve existing page headers (starting with `# `)
- System shall preserve existing section headers (starting with `## `)
- System shall correctly distinguish level 1 headers from level 2+ headers

**Change Preview Quality:**
- System shall show file identification clearly in change output
- System shall display line references with consistent width based on maximum line number

**Known Limitations:**
- Diff output may not correctly display blank line additions in all cases (blank lines shown with ␤ character may have incorrect line numbering or positioning)
- System shall visualize trailing whitespace removal with special characters
- System shall use colors to distinguish additions (green) and removals (red)
- System shall group changes by file with clear separators
- System shall only show lines that have changes, omitting unchanged content
- System shall provide context lines before and after changes for better readability
- System shall maintain sequential line numbering that reflects final file positions
- System shall ensure line number continuity throughout diff output

**Relation Link Enhancement:**
- System shall convert simple identifiers (non-markdown format) to proper markdown link format
- System shall convert absolute links to relative links where appropriate
- System shall preserve already correct relative links without modification
- System shall replace fragment-only same-file references with full element names
- System shall convert implementation file paths to clean filename references
- System shall preserve external URLs without modification

##### Test Criteria
1. **Basic format functionality**
   - Format command runs successfully on test markdown files
   - Dry-run mode shows preview without making changes
   - Actual format command applies changes correctly
   - Format command shows diff output when applying changes (not only in dry-run)
   - JSON flag produces structured output with formatting results

2. **Content preservation verification**
   - Personas sections remain intact after formatting
   - Element content and structure preserved
   - Section ordering maintained correctly
   - Page and section content preserved

3. **Change detection and preview**
   - Changes are clearly identified by file
   - Line references include consistent number width
   - Trailing whitespace removal is visualized
   - Color coding distinguishes addition/removal changes
   - Context lines provide readable context around changes
   - Line numbering maintains sequential continuity reflecting final file positions

4. **Relation link quality**
   - Simple identifiers are converted to proper markdown link format
   - Absolute links are converted to relative links where appropriate
   - Already correct relative links remain unchanged
   - Same-file references use human-readable element names
   - Implementation file references show clean filenames
   - Fragment references use proper notation

5. **Formatting consistency**
   - Excess whitespace is trimmed appropriately
   - Separators are inserted correctly between elements
   - Consecutive separators are normalized to single separators
   - Relation indentation is normalized to proper 2-space format
   - Line endings are normalized

6. **Line numbering accuracy**
   - Line numbers in diff output are sequential and consistent
   - Context lines maintain proper numbering continuity
   - Added lines show correct position in final file
   - Line numbering reflects final file structure accurately

#### Metadata
  * type: test-verification

#### Relations
  * verify: [Format Command](../SystemRequirements/Requirements.md#format-command)
  * verify: [Document Structure Normalization](../SystemRequirements/Requirements.md#document-structure-normalization)
  * verify: [Model Formatting](../UserRequirements.md#model-formatting)
  * verify: [Format Consistency Enforcement](../UserRequirements.md#format-consistency-enforcement)
  * verify: [Formatting Output](../UserRequirements.md#formatting-output)
  * verify: [Structure of Markdown Documents](../SpecificationsRequirements.md#structure-of-markdown-documents)
  * satisfiedBy: [test.sh](../../tests/test-advanced-format/test.sh)
---