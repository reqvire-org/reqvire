# Diagram Tests

This document verifies the requirements for Reqvire's diagram generation functionality.

## Diagram Generation Tests
```mermaid
graph LR;
  %% REQVIRE-AUTOGENERATED-DIAGRAM
  %% Graph styling
  classDef userRequirement fill:#f9d6d6,stroke:#f55f5f,stroke-width:1px;
  classDef systemRequirement fill:#fce4e4,stroke:#e68a8a,stroke-width:1px;
  classDef verification fill:#d6f9d6,stroke:#5fd75f,stroke-width:1px;
  classDef default fill:#f5f5f5,stroke:#333333,stroke-width:1px;

  f8849dfe948d04fa["Automated Diagram Generation on PR Merge Verification"];
  class f8849dfe948d04fa verification;
  click f8849dfe948d04fa "DiagramsTests.md#automated-diagram-generation-on-pr-merge-verification";
  98af8a1cf9c86822["generate_diagrams.yml"];
  class 98af8a1cf9c86822 default;
  click 98af8a1cf9c86822 "../../.github/workflows/generate_diagrams.yml";
  f8849dfe948d04fa -->|satisfiedBy| 98af8a1cf9c86822;
  2d2cf67bb8070da8["Diagram Generation Test"];
  class 2d2cf67bb8070da8 verification;
  click 2d2cf67bb8070da8 "DiagramsTests.md#diagram-generation-test";
  3df49fd1a91c3db7["test.sh"];
  class 3df49fd1a91c3db7 default;
  click 3df49fd1a91c3db7 "../../tests/test-diagram-generation/test.sh";
  2d2cf67bb8070da8 -->|satisfiedBy| 3df49fd1a91c3db7;
  ba2fd3fb7c42cdb3["Diagram Relation Filtering Verification"];
  class ba2fd3fb7c42cdb3 verification;
  click ba2fd3fb7c42cdb3 "DiagramsTests.md#diagram-relation-filtering-verification";
  f6a73030d877fc0f["test.sh"];
  class f6a73030d877fc0f default;
  click f6a73030d877fc0f "../../tests/test-diagram-filtering/test.sh";
  ba2fd3fb7c42cdb3 -->|satisfiedBy| f6a73030d877fc0f;
  6a6973ecb2f20ee3["Remove Generated Diagrams Verification"];
  class 6a6973ecb2f20ee3 verification;
  click 6a6973ecb2f20ee3 "DiagramsTests.md#remove-generated-diagrams-verification";
  af81a7b6d75c2363["test.sh"];
  class af81a7b6d75c2363 default;
  click af81a7b6d75c2363 "../../tests/test-remove-diagrams/test.sh";
  6a6973ecb2f20ee3 -->|satisfiedBy| af81a7b6d75c2363;
  de8ab093f22a5cd7["Visualize Model Relationships Verification"];
  class de8ab093f22a5cd7 verification;
  click de8ab093f22a5cd7 "DiagramsTests.md#visualize-model-relationships-verification";
  3df49fd1a91c3db7["test.sh"];
  class 3df49fd1a91c3db7 default;
  click 3df49fd1a91c3db7 "../../tests/test-diagram-generation/test.sh";
  de8ab093f22a5cd7 -->|satisfiedBy| 3df49fd1a91c3db7;
  53b9aea65494b30a["Automated Diagram Generation on PR Merge"];
  class 53b9aea65494b30a systemRequirement;
  click 53b9aea65494b30a "../Integrations/GitHub.md#automated-diagram-generation-on-pr-merge";
  98af8a1cf9c86822["generate_diagrams.yml"];
  class 98af8a1cf9c86822 default;
  click 98af8a1cf9c86822 "../../.github/workflows/generate_diagrams.yml";
  53b9aea65494b30a -->|satisfiedBy| 98af8a1cf9c86822;
  53b9aea65494b30a -.->|verifiedBy| f8849dfe948d04fa;
  626af7bb0e4f5bdf["Auto-Generated Diagram Identification"];
  class 626af7bb0e4f5bdf systemRequirement;
  click 626af7bb0e4f5bdf "../ReqvireTool/ModelManagement/DiagramGeneration.md#auto-generated-diagram-identification";
  dad7eeb932afdb92["diagrams.rs"];
  class dad7eeb932afdb92 default;
  click dad7eeb932afdb92 "../../core/src/diagrams.rs";
  626af7bb0e4f5bdf -->|satisfiedBy| dad7eeb932afdb92;
  f22d93285fcd7664["parser.rs"];
  class f22d93285fcd7664 default;
  click f22d93285fcd7664 "../../core/src/parser.rs";
  626af7bb0e4f5bdf -->|satisfiedBy| f22d93285fcd7664;
  ce2625feec883e55["utils.rs"];
  class ce2625feec883e55 default;
  click ce2625feec883e55 "../../core/src/utils.rs";
  626af7bb0e4f5bdf -->|satisfiedBy| ce2625feec883e55;
  626af7bb0e4f5bdf -.->|verifiedBy| 2d2cf67bb8070da8;
  626af7bb0e4f5bdf -.->|verifiedBy| 6a6973ecb2f20ee3;
  78e3cd9cda00a39["Diagram Relation Filtering"];
  class 78e3cd9cda00a39 systemRequirement;
  click 78e3cd9cda00a39 "../ReqvireTool/ModelManagement/DiagramGeneration.md#diagram-relation-filtering";
  dad7eeb932afdb92["diagrams.rs"];
  class dad7eeb932afdb92 default;
  click dad7eeb932afdb92 "../../core/src/diagrams.rs";
  78e3cd9cda00a39 -->|satisfiedBy| dad7eeb932afdb92;
  78e3cd9cda00a39 -.->|verifiedBy| ba2fd3fb7c42cdb3;
  dae82e912381c0d8["CLI Generate Diagrams Flag"];
  class dae82e912381c0d8 systemRequirement;
  click dae82e912381c0d8 "../ReqvireTool/UserInterface/CLI.md#cli-generate-diagrams-flag";
  80defdd4cbc7ee18["cli.rs"];
  class 80defdd4cbc7ee18 default;
  click 80defdd4cbc7ee18 "../../cli/src/cli.rs";
  dae82e912381c0d8 -->|satisfiedBy| 80defdd4cbc7ee18;
  dae82e912381c0d8 -.->|verifiedBy| 2d2cf67bb8070da8;
  34c75e4a88e1f381["CLI Help Structure Verification"];
  class 34c75e4a88e1f381 verification;
  click 34c75e4a88e1f381 "Misc.md#cli-help-structure-verification";
  dae82e912381c0d8 -.->|verifiedBy| 34c75e4a88e1f381;
  6ca4ccd32e3b556["CLI Remove Diagrams Flag"];
  class 6ca4ccd32e3b556 systemRequirement;
  click 6ca4ccd32e3b556 "../ReqvireTool/UserInterface/CLI.md#cli-remove-diagrams-flag";
  80defdd4cbc7ee18["cli.rs"];
  class 80defdd4cbc7ee18 default;
  click 80defdd4cbc7ee18 "../../cli/src/cli.rs";
  6ca4ccd32e3b556 -->|satisfiedBy| 80defdd4cbc7ee18;
  6ca4ccd32e3b556 -.->|verifiedBy| 6a6973ecb2f20ee3;
  6ca4ccd32e3b556 -.->|verifiedBy| 34c75e4a88e1f381;
  98a581084d5542fa["Automate Diagram Generation"];
  class 98a581084d5542fa userRequirement;
  click 98a581084d5542fa "../UserRequirements.md#automate-diagram-generation";
  98a581084d5542fa -.->|deriveReqT| 53b9aea65494b30a;
  98a581084d5542fa -.->|verifiedBy| 2d2cf67bb8070da8;
  98a581084d5542fa -.->|verifiedBy| de8ab093f22a5cd7;
```
### Diagram Generation Test

This test verifies that the system can automatically generate and embed mermaid diagrams in requirements documents.

#### Details

##### Acceptance Criteria
- System should process requirements files and add/update embedded mermaid diagrams
- System should create diagrams that represent relationships between elements
- System should preserve any existing custom mermaid diagrams in the documents
- System should update automatically generated diagrams when requirements change
- System should properly visualize all relationship types (verifies, trace, derives, satisfies, etc.)
- System should render relationships with appropriate arrows and formatting
- All auto-generated diagrams must include the REQVIRE-AUTOGENERATED-DIAGRAM marker for identification
- Marker should be embedded within the mermaid diagram as a comment for reliable identification

##### Test Criteria
- Command exits with success (0) return code
- Modified files contain the expected mermaid diagrams
- Custom mermaid diagrams are preserved
- Diagram content accurately reflects the relationships defined in the requirements
- All relationship types are correctly visualized with proper arrows and labels (verifies, trace, derives, satisfies)
- Special relationship types like "deriveReqT" are properly rendered
- All auto-generated diagrams contain the REQVIRE-AUTOGENERATED-DIAGRAM marker
- Marker appears as a mermaid comment within the diagram block

#### Metadata
  * type: test-verification

#### Relations
  * verify: [Automate Diagram Generation](../UserRequirements.md#automate-diagram-generation)
  * verify: [Auto-Generated Diagram Identification](../ReqvireTool/ModelManagement/DiagramGeneration.md#auto-generated-diagram-identification)
  * satisfiedBy: [test.sh](../../tests/test-diagram-generation/test.sh)
---

### Visualize Model Relationships Verification

This test verifies that the system provides visual representations of relationships within the MBSE model in the generated diagrams.

#### Details

##### Acceptance Criteria
- System should generate diagrams showing relationships between model elements
- Diagrams should clearly represent different relationship types
- Visual representation should aid in understanding dependencies between elements

##### Test Criteria
- Command exits with success (0) return code
- Generated diagrams contain all expected relationship types
- Relationships are visually differentiated based on their type
- Element dependencies are clearly displayed in the diagrams

#### Metadata
  * type: test-verification

#### Relations
  * verify: [Automate Diagram Generation](../UserRequirements.md#automate-diagram-generation)
  * satisfiedBy: [test.sh](../../tests/test-diagram-generation/test.sh)
---

### Automated Diagram Generation on PR Merge Verification

This test verifies that the system automatically generates and updates diagrams when pull requests are merged to the main branch.

#### Details

##### Acceptance Criteria
- System should have a GitHub workflow that automatically generates diagrams on PR merge
- The workflow should only be triggered when PRs are merged to the main branch
- Generated diagrams and traceability matrix SVG should be committed back to the main branch
- The commit message should clearly indicate the automated nature of the change

##### Test Criteria
- Workflow defined in the GitHub workflow configuration correctly
- Workflow triggers only on PR merge to main branch
- Workflow correctly checks out code, builds the tool, and generates diagrams
- Workflow generates a traceability matrix SVG file
- Workflow commits and pushes changes back to the main branch
- Commit message is informative and standardized

#### Metadata
  * type: test-verification

#### Relations
  * verify: [Automated Diagram Generation on PR Merge](../Integrations/GitHub.md#automated-diagram-generation-on-pr-merge)
  * satisfiedBy: [generate_diagrams.yml](../../.github/workflows/generate_diagrams.yml)
---

### Diagram Relation Filtering Verification

This test verifies that the system correctly filters relations in diagram generation to render only forward relations while ensuring complete element hierarchy representation.

#### Details

##### Acceptance Criteria
- System should render only relations from DIAGRAM_RELATIONS list to prevent duplicate arrows for bidirectional relationships
- System should include parent elements in diagrams even when they belong to different sections
- System should apply list-based rendering according to DIAGRAM_RELATIONS specification
- Generated diagrams should not contain both relations from opposite pairs for the same logical relationship

##### Test Criteria
- Command exits with success (0) return code
- Diagrams contain only relations specified in DIAGRAM_RELATIONS (e.g., `derive` but not `derivedFrom`)
- Bidirectional relationships appear as single arrows using the relation specified in DIAGRAM_RELATIONS
- Parent elements are included when child elements are in the section
- No duplicate arrows exist for the same logical relationship
- Arrow rendering follows the DIAGRAM_RELATIONS list specification

#### Metadata
  * type: test-verification

#### Relations
  * verify: [Diagram Relation Filtering](../ReqvireTool/ModelManagement/DiagramGeneration.md#diagram-relation-filtering)
  * satisfiedBy: [test.sh](../../tests/test-diagram-filtering/test.sh)
---

### Remove Generated Diagrams Verification

This test verifies that the system can remove all generated mermaid diagrams while preserving custom user-created diagrams and respecting file exclusion patterns.

#### Details

##### Acceptance Criteria
- System should remove all auto-generated mermaid diagrams identified by the REQVIRE-AUTOGENERATED-DIAGRAM marker
- System should preserve custom mermaid diagrams that do not contain the auto-generation marker
- System should respect exclusion patterns defined in .gitignore and .reqvireignore files
- System should handle files with multiple diagrams correctly, removing only marked ones
- System should work on files without any diagrams
- System should maintain file structure and content except for diagram removal
- Auto-generated diagrams must contain the REQVIRE-AUTOGENERATED-DIAGRAM marker for identification
- Marker-based identification should work regardless of diagram location in the document

##### Test Criteria
- Command exits with success (0) return code
- Auto-generated diagrams containing REQVIRE-AUTOGENERATED-DIAGRAM marker are removed from files
- Custom diagrams without the marker are preserved regardless of their location
- Files matching exclusion patterns are not processed for diagram removal
- File structure remains intact except for diagram removal
- Element text and relationships are preserved
- Section headers and element headers are preserved
- Mixed files with both auto-generated (marked) and custom (unmarked) diagrams handle removal correctly

#### Metadata
  * type: test-verification

#### Relations
  * verify: [Auto-Generated Diagram Identification](../ReqvireTool/ModelManagement/DiagramGeneration.md#auto-generated-diagram-identification)
  * satisfiedBy: [test.sh](../../tests/test-remove-diagrams/test.sh)
---