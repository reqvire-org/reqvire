# Change Impact Detection

This document defines the detailed requirements for the change impact detection algorithm and visualization in Reqvire.

## Change Impact Detection Components
```mermaid
graph LR;
  %% REQVIRE-AUTOGENERATED-DIAGRAM
  %% Graph styling
  classDef userRequirement fill:#f9d6d6,stroke:#f55f5f,stroke-width:1px;
  classDef systemRequirement fill:#fce4e4,stroke:#e68a8a,stroke-width:1px;
  classDef verification fill:#d6f9d6,stroke:#5fd75f,stroke-width:1px;
  classDef default fill:#f5f5f5,stroke:#333333,stroke-width:1px;

  4ba519ed09b81863["Change Impact Visualization"];
  class 4ba519ed09b81863 systemRequirement;
  click 4ba519ed09b81863 "ChangeImpactPropagation.md#change-impact-visualization";
  4b89dbed94c08c3e["change_impact.rs"];
  class 4b89dbed94c08c3e default;
  click 4b89dbed94c08c3e "../../core/src/change_impact.rs";
  4ba519ed09b81863 -->|satisfiedBy| 4b89dbed94c08c3e;
  98d7b16583855bb7["Change Impact Detection Test"];
  class 98d7b16583855bb7 verification;
  click 98d7b16583855bb7 "../Verifications/ChangeImpactTests.md#change-impact-detection-test";
  4ba519ed09b81863 -.->|verifiedBy| 98d7b16583855bb7;
  37a75398bd174177["Change Impact Command Line Interface"];
  class 37a75398bd174177 systemRequirement;
  click 37a75398bd174177 "ChangeImpactPropagation.md#change-impact-command-line-interface";
  80defdd4cbc7ee18["cli.rs"];
  class 80defdd4cbc7ee18 default;
  click 80defdd4cbc7ee18 "../../cli/src/cli.rs";
  37a75398bd174177 -->|satisfiedBy| 80defdd4cbc7ee18;
  cec02a5e3f71bed1["Change Impact Relations Test"];
  class cec02a5e3f71bed1 verification;
  click cec02a5e3f71bed1 "../Verifications/ChangeImpactTests.md#change-impact-relations-test";
  37a75398bd174177 -.->|verifiedBy| cec02a5e3f71bed1;
  37a75398bd174177 -.->|verifiedBy| 98d7b16583855bb7;
  ced028f36159c967["Smart Filtering for Change Impact Reports"];
  class ced028f36159c967 systemRequirement;
  click ced028f36159c967 "ChangeImpactPropagation.md#smart-filtering-for-change-impact-reports";
  4b89dbed94c08c3e["change_impact.rs"];
  class 4b89dbed94c08c3e default;
  click 4b89dbed94c08c3e "../../core/src/change_impact.rs";
  ced028f36159c967 -->|satisfiedBy| 4b89dbed94c08c3e;
  ced028f36159c967 -.->|verifiedBy| 98d7b16583855bb7;
  4f17266696162a10["Change Impact Smart Filtering Test"];
  class 4f17266696162a10 verification;
  click 4f17266696162a10 "../Verifications/ChangeImpactTests.md#change-impact-smart-filtering-test";
  ced028f36159c967 -.->|verifiedBy| 4f17266696162a10;
  c8d1020a3844532d["Change Impact Detection Algorithm"];
  class c8d1020a3844532d systemRequirement;
  click c8d1020a3844532d "ChangeImpactPropagation.md#change-impact-detection-algorithm";
  4b89dbed94c08c3e["change_impact.rs"];
  class 4b89dbed94c08c3e default;
  click 4b89dbed94c08c3e "../../core/src/change_impact.rs";
  c8d1020a3844532d -->|satisfiedBy| 4b89dbed94c08c3e;
  a4090fe7e30eeae4["Element Content Extraction Test"];
  class a4090fe7e30eeae4 verification;
  click a4090fe7e30eeae4 "../Verifications/ChangeImpactTests.md#element-content-extraction-test";
  c8d1020a3844532d -.->|verifiedBy| a4090fe7e30eeae4;
  c8d1020a3844532d -.->|verifiedBy| cec02a5e3f71bed1;
  c8d1020a3844532d -.->|verifiedBy| 98d7b16583855bb7;
  4c9ae0a2fb751ce6["CLI Change Impact Report Command"];
  class 4c9ae0a2fb751ce6 systemRequirement;
  click 4c9ae0a2fb751ce6 "Requirements.md#cli-change-impact-report-command";
  80defdd4cbc7ee18["cli.rs"];
  class 80defdd4cbc7ee18 default;
  click 80defdd4cbc7ee18 "../../cli/src/cli.rs";
  4c9ae0a2fb751ce6 -->|satisfiedBy| 80defdd4cbc7ee18;
  34c75e4a88e1f381["CLI Help Structure Verification"];
  class 34c75e4a88e1f381 verification;
  click 34c75e4a88e1f381 "../Verifications/Misc.md#cli-help-structure-verification";
  4c9ae0a2fb751ce6 -.->|verifiedBy| 34c75e4a88e1f381;
  6c40e66699ba40dd["CLI Git Commit Hash Flag"];
  class 6c40e66699ba40dd systemRequirement;
  click 6c40e66699ba40dd "Requirements.md#cli-git-commit-hash-flag";
  4c9ae0a2fb751ce6 -.->|deriveReqT| 6c40e66699ba40dd;
  4c9ae0a2fb751ce6 -.->|deriveReqT| 37a75398bd174177;
  9933cac5853a8584["Change Impact Analysis"];
  class 9933cac5853a8584 userRequirement;
  click 9933cac5853a8584 "../UserRequirements.md#change-impact-analysis";
  b72d56e7e360fe6c["Change Impact Analysis Verification"];
  class b72d56e7e360fe6c verification;
  click b72d56e7e360fe6c "../Verifications/ChangeImpactTests.md#change-impact-analysis-verification";
  9933cac5853a8584 -.->|verifiedBy| b72d56e7e360fe6c;
  9933cac5853a8584 -.->|deriveReqT| ced028f36159c967;
  2054606d7574a553["Requirements Change Propagation"];
  class 2054606d7574a553 userRequirement;
  click 2054606d7574a553 "../SpecificationsRequirements.md#requirements-change-propagation";
  9933cac5853a8584 -.->|deriveReqT| 2054606d7574a553;
  2054606d7574a553 -.->|deriveReqT| 4ba519ed09b81863;
  2054606d7574a553 -.->|deriveReqT| ced028f36159c967;
  2054606d7574a553 -.->|deriveReqT| c8d1020a3844532d;
```
### Change Impact Detection Algorithm

The system shall implement a requirement change detection algorithm that identifies changes between versions of the model and determines their impact through relationship traversal.

#### Details
The algorithm shall consist of the following steps:

1. **Diff Analysis**:
   - Compare the current state of a requirement with its previous state
   - Identify structural changes (additions, deletions, modifications)
   - Generate a ChangeSet representing all detected changes
   - Associate changes with specific elements in the model

2. **Impact Determination**:
   - For each changed element, identify all relations from the element
   - Apply relation-specific propagation rules as defined in RelationTypesRegistry.md
   - Consider the relation direction and change impact direction for each relation
   - Build an impact tree representing the propagation of changes

3. **Recursive Traversal**:
   - Perform a depth-first traversal of relationships
   - Create a directed acyclic graph (DAG) of change impact
   - Handle circular dependencies by preventing infinite recursion
   - Track visited nodes to prevent duplicate processing

4. **Impact Classification**:
   - Assign impact severity levels based on relation types
   - Classify changes as:
     - Direct: Changes to the element itself
     - Indirect: Changes propagated from related elements
     - Potential: Changes that might affect an element based on semantic analysis
   - Calculate aggregated impact scores for each affected element

6. **Performance Optimization**:
   - Implement caching of traversal results
   - Use parallel processing for independent branches of the impact tree
   - Apply pruning techniques to limit traversal depth when appropriate
   - Support incremental impact analysis for large models

#### Relations
  * derivedFrom: [Requirements Change Propagation](../SpecificationsRequirements.md#requirements-change-propagation)
  * satisfiedBy: [change_impact.rs](../../core/src/change_impact.rs)
---

### Change Impact Visualization

The system shall provide visual representations of change impact to help users understand the scope and implications of changes.

#### Details
The visualization shall include:

1. **Tree View**:
   - Display a hierarchical tree of affected elements
   - Group elements by impact type (direct, indirect, potential)
   - Show relation types between elements
   - Support collapsing/expanding nodes for better navigation

2. **Color Coding**:
   - Use consistent color scheme for impact types:
     - Direct impacts: Red
     - Indirect impacts: Yellow
     - Potential impacts: Blue
   - Indicate relation types with different line styles
   - Highlight newly introduced or removed relationships

3. **Interactive Elements**:
   - Allow clicking on elements to focus the view

4. **Summary Statistics**:
   - Display counts of affected elements by type
   - Show metrics for impact breadth and depth
   - Calculate change propagation fan-out metrics
   - Generate overall change impact assessment

#### Relations
  * derivedFrom: [Requirements Change Propagation](../SpecificationsRequirements.md#requirements-change-propagation)
  * satisfiedBy: [change_impact.rs](../../core/src/change_impact.rs)
  * verifiedBy: [Change Impact Detection Test](../Verifications/ChangeImpactTests.md#change-impact-detection-test)
---

### Smart Filtering for Change Impact Reports

The system shall implement intelligent filtering logic to eliminate redundant information from change impact reports and focus on primary changes and their relationships.

#### Details
<details>
<summary>View Full Specification</summary>


The smart filtering shall implement the following logic:

1. **Primary Change Detection**:
   - Distinguish between primary changes (elements that are modified, added, or removed as the main focus) and secondary changes (elements that appear in relations of primary changes)
   - Filter out elements that are already referenced in the relations of other elements to prevent duplicate entries
   - Apply filtering to both new-to-new and changed-to-changed element relationships

2. **Comprehensive Filtering Rules**:
   - **Eliminate Redundant New Elements**: If a new element is referenced in the relations of another new or changed element, do not show it separately in the "New Elements" section
   - **Eliminate Redundant Changed Elements**: If a changed element is referenced in the relations of another changed element, do not show it separately in the "Changed Elements" section  
   - **Show Only Independent Elements**: Elements should only appear in their own section if they are not already covered by relationships from other elements in the same report
   - **Relation Context Marking**: When displaying relations, mark elements that are new with "(new)" suffix and changed elements with "⚠️" symbol to provide context about the status of relation targets

3. **Cross-Category Filtering**:
   - Apply filtering across all categories (new, changed, removed)
   - A changed element referenced by another changed element should not appear as standalone
   - A new element referenced by a changed element should not appear as standalone
   - Preserve the most informative context for each filtered element

4. **Hierarchical Organization**:
   - Present changes in order of importance: modified elements first, then independent new elements, then removed elements
   - Group related changes together to show impact chains clearly
   - Maintain complete traceability while reducing visual clutter

5. **Benefits**:
   - **Reduced Clutter**: Eliminates redundant information that appears in multiple places
   - **Improved Focus**: Readers can quickly identify primary changes without scanning duplicate entries
   - **Clear Context**: Elements are shown in their most relevant relationship context
   - **Better Readability**: Reports are more concise while maintaining complete information

#### Enhanced Filtering Examples

**Example 1: New Element Filtering**

Before Smart Filtering:
```
New Elements:
- Element A (new)
- Element B (new)  
- Element C (new)

Changed Elements:
- Element X
  Relations:
  * derivedFrom: Element A
  * verifiedBy: Element B
```

After Smart Filtering:
```
Changed Elements:
- Element X
  Relations:
  * derivedFrom: Element A (new)
  * verifiedBy: Element B (new)

New Elements:
- Element C (new)
```

**Example 2: Changed Element Filtering**

Before Smart Filtering:
```
Changed Elements:
- Power Saving Mode (changed)
  Relations:
  * verifiedBy: Power Saving
- Power Saving (changed)
```

After Smart Filtering:
```
Changed Elements:
- Power Saving Mode (changed)
  Relations:
  * verifiedBy: Power Saving ⚠️
```

**Example 3: Cross-Category Filtering**

Before Smart Filtering:
```
New Elements:
- New Verification (new)

Changed Elements:
- Updated Requirement (changed)
  Relations:
  * verifiedBy: New Verification
- New Verification (new)
```

After Smart Filtering:
```
Changed Elements:
- Updated Requirement (changed)
  Relations:
  * verifiedBy: New Verification (new)
```

</details>

#### Relations
  * derivedFrom: [Change Impact Analysis](../UserRequirements.md#change-impact-analysis)
  * derivedFrom: [Requirements Change Propagation](../SpecificationsRequirements.md#requirements-change-propagation)
  * satisfiedBy: [change_impact.rs](../../core/src/change_impact.rs)
---

### Change Impact Command Line Interface

The system shall provide a command-line interface for initiating change impact analysis and controlling output formats.

#### Details
The CLI shall support the following functionality:

1. **Analysis Invocation**:
   - Support analyzing changes between git commits
   - Enable specifying elements to analyze by ID or pattern
   - Allow limiting analysis to specific relation types
   - Support depth limitations for large models

2. **Output Formats**:
   - Generate formatted text reports
   - Produce JSON-structured impact data
   - Create Mermaid diagrams of impact trees
   - Integrate with HTML report generation

3. **Integration Points**:
   - Support integration with CI/CD pipelines
   - Enable calling from external systems via API
   - Support webhook triggers for automated analysis
   - Allow scripting of analysis operations

#### Relations
  * derivedFrom: [CLI Change Impact Report Command](Requirements.md#cli-change-impact-report-command)
  * satisfiedBy: [cli.rs](../../cli/src/cli.rs)
---