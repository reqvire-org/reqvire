# Formatting

## Format Implementation
```mermaid
graph LR;
  %% REQVIRE-AUTOGENERATED-DIAGRAM
  %% Graph styling
  classDef userRequirement fill:#f9d6d6,stroke:#f55f5f,stroke-width:1px;
  classDef systemRequirement fill:#fce4e4,stroke:#e68a8a,stroke-width:1px;
  classDef verification fill:#d6f9d6,stroke:#5fd75f,stroke-width:1px;
  classDef default fill:#f5f5f5,stroke:#333333,stroke-width:1px;

  565cc5dfa0512876["Document Structure Normalization"];
  class 565cc5dfa0512876 systemRequirement;
  click 565cc5dfa0512876 "Formatting.md#document-structure-normalization";
  b7c871ab64a7059a["graph_registry.rs"];
  class b7c871ab64a7059a default;
  click b7c871ab64a7059a "../../../core/src/graph_registry.rs";
  565cc5dfa0512876 -->|satisfiedBy| b7c871ab64a7059a;
  f22d93285fcd7664["parser.rs"];
  class f22d93285fcd7664 default;
  click f22d93285fcd7664 "../../../core/src/parser.rs";
  565cc5dfa0512876 -->|satisfiedBy| f22d93285fcd7664;
  735766802775ec41["Format Command Requirements Verification"];
  class 735766802775ec41 verification;
  click 735766802775ec41 "../../Verifications/Misc.md#format-command-requirements-verification";
  565cc5dfa0512876 -.->|verifiedBy| 735766802775ec41;
  48079820e0958064["Excess Whitespace Format Implementation"];
  class 48079820e0958064 systemRequirement;
  click 48079820e0958064 "Formatting.md#excess-whitespace-format-implementation";
  8fbf4ca0471377ea["format.rs"];
  class 8fbf4ca0471377ea default;
  click 8fbf4ca0471377ea "../../../core/src/format.rs";
  48079820e0958064 -->|satisfiedBy| 8fbf4ca0471377ea;
  48079820e0958064 -.->|verifiedBy| 735766802775ec41;
  dd454dd5831a33a0["File Pattern Exclusion for Format"];
  class dd454dd5831a33a0 systemRequirement;
  click dd454dd5831a33a0 "Formatting.md#file-pattern-exclusion-for-format";
  1bb19f609996c42d["Excluded File Relation Validation"];
  class 1bb19f609996c42d systemRequirement;
  click 1bb19f609996c42d "Validation.md#excluded-file-relation-validation";
  dd454dd5831a33a0 -.->|deriveReqT| 1bb19f609996c42d;
  ce2625feec883e55["utils.rs"];
  class ce2625feec883e55 default;
  click ce2625feec883e55 "../../../core/src/utils.rs";
  dd454dd5831a33a0 -->|satisfiedBy| ce2625feec883e55;
  39d8198b424886f5["Git-Style Diff Output for Format"];
  class 39d8198b424886f5 systemRequirement;
  click 39d8198b424886f5 "Formatting.md#git-style-diff-output-for-format";
  8fbf4ca0471377ea["format.rs"];
  class 8fbf4ca0471377ea default;
  click 8fbf4ca0471377ea "../../../core/src/format.rs";
  39d8198b424886f5 -->|satisfiedBy| 8fbf4ca0471377ea;
  39d8198b424886f5 -.->|verifiedBy| 735766802775ec41;
  b3dfaa5f76484ceb["Inconsistent Newlines Format Implementation"];
  class b3dfaa5f76484ceb systemRequirement;
  click b3dfaa5f76484ceb "Formatting.md#inconsistent-newlines-format-implementation";
  8fbf4ca0471377ea["format.rs"];
  class 8fbf4ca0471377ea default;
  click 8fbf4ca0471377ea "../../../core/src/format.rs";
  b3dfaa5f76484ceb -->|satisfiedBy| 8fbf4ca0471377ea;
  b3dfaa5f76484ceb -.->|verifiedBy| 735766802775ec41;
  61f2a6a1c9804b94["Missing Separators Format Implementation"];
  class 61f2a6a1c9804b94 systemRequirement;
  click 61f2a6a1c9804b94 "Formatting.md#missing-separators-format-implementation";
  8fbf4ca0471377ea["format.rs"];
  class 8fbf4ca0471377ea default;
  click 8fbf4ca0471377ea "../../../core/src/format.rs";
  61f2a6a1c9804b94 -->|satisfiedBy| 8fbf4ca0471377ea;
  61f2a6a1c9804b94 -.->|verifiedBy| 735766802775ec41;
  b92b29e4582bfb78["Reserved Subsections Format Implementation"];
  class b92b29e4582bfb78 systemRequirement;
  click b92b29e4582bfb78 "Formatting.md#reserved-subsections-format-implementation";
  8fbf4ca0471377ea["format.rs"];
  class 8fbf4ca0471377ea default;
  click 8fbf4ca0471377ea "../../../core/src/format.rs";
  b92b29e4582bfb78 -->|satisfiedBy| 8fbf4ca0471377ea;
  b92b29e4582bfb78 -.->|verifiedBy| 735766802775ec41;
  1fbfcaddda85a6c2["Ignoring Unstructured Documents"];
  class 1fbfcaddda85a6c2 systemRequirement;
  click 1fbfcaddda85a6c2 "../Storage/Configuration.md#ignoring-unstructured-documents";
  767f898924bcaf15["Ignore Files Integration"];
  class 767f898924bcaf15 systemRequirement;
  click 767f898924bcaf15 "../Storage/Configuration.md#ignore-files-integration";
  1fbfcaddda85a6c2 -.->|deriveReqT| 767f898924bcaf15;
  45f9231a94c04f4e["Requirements Processing"];
  class 45f9231a94c04f4e systemRequirement;
  click 45f9231a94c04f4e "../Storage/Configuration.md#requirements-processing";
  1fbfcaddda85a6c2 -.->|deriveReqT| 45f9231a94c04f4e;
  3ff9961dd21bf22e["Reserved Repository Files Exclusion"];
  class 3ff9961dd21bf22e systemRequirement;
  click 3ff9961dd21bf22e "../Storage/Configuration.md#reserved-repository-files-exclusion";
  1fbfcaddda85a6c2 -.->|deriveReqT| 3ff9961dd21bf22e;
  1fbfcaddda85a6c2 -.->|deriveReqT| dd454dd5831a33a0;
  8419dcc77d92b609["config.rs"];
  class 8419dcc77d92b609 default;
  click 8419dcc77d92b609 "../../../cli/src/config.rs";
  1fbfcaddda85a6c2 -->|satisfiedBy| 8419dcc77d92b609;
  974ccf933675ef44["Format Consistency Enforcement"];
  class 974ccf933675ef44 userRequirement;
  click 974ccf933675ef44 "../../UserRequirements.md#format-consistency-enforcement";
  974ccf933675ef44 -.->|deriveReqT| 565cc5dfa0512876;
  974ccf933675ef44 -.->|deriveReqT| 48079820e0958064;
  974ccf933675ef44 -.->|deriveReqT| b3dfaa5f76484ceb;
  974ccf933675ef44 -.->|deriveReqT| 61f2a6a1c9804b94;
  974ccf933675ef44 -.->|deriveReqT| b92b29e4582bfb78;
  c9988cdcfdea77a["Formatting Output"];
  class c9988cdcfdea77a userRequirement;
  click c9988cdcfdea77a "../../UserRequirements.md#formatting-output";
  c9988cdcfdea77a -.->|deriveReqT| 39d8198b424886f5;
```
### Excess Whitespace Format Implementation

The system shall detect and fix excess whitespace after element headers, subsection headers, and relation identifiers to maintain consistent formatting across all requirements documents.

#### Relations
  * derivedFrom: [Format Consistency Enforcement](../../UserRequirements.md#format-consistency-enforcement)
  * satisfiedBy: [format.rs](../../../core/src/format.rs)
  * verifiedBy: [Format Command Requirements Verification](../../Verifications/Misc.md#format-command-requirements-verification)
---

### Inconsistent Newlines Format Implementation

The system shall detect and fix excess or missing newlines before element headers, subsection headers to maintain consistent formatting across all requirements documents.

#### Relations
  * derivedFrom: [Format Consistency Enforcement](../../UserRequirements.md#format-consistency-enforcement)
  * satisfiedBy: [format.rs](../../../core/src/format.rs)
  * verifiedBy: [Format Command Requirements Verification](../../Verifications/Misc.md#format-command-requirements-verification)
---

### Missing Separators Format Implementation

The system shall detect consecutive element sections that lack a separator line (---) between them and insert the separator to maintain consistent visual separation in the documentation.

#### Relations
  * derivedFrom: [Format Consistency Enforcement](../../UserRequirements.md#format-consistency-enforcement)
  * satisfiedBy: [format.rs](../../../core/src/format.rs)
  * verifiedBy: [Format Command Requirements Verification](../../Verifications/Misc.md#format-command-requirements-verification)
---

### Reserved Subsections Format Implementation

The system shall identify and fix inconsistent indentation and bullet types in relation lists and other reserved subsections, standardizing to a consistent format across all requirements documents.

#### Relations
  * derivedFrom: [Format Consistency Enforcement](../../UserRequirements.md#format-consistency-enforcement)
  * satisfiedBy: [format.rs](../../../core/src/format.rs)
  * verifiedBy: [Format Command Requirements Verification](../../Verifications/Misc.md#format-command-requirements-verification)
---

### Git-Style Diff Output for Format

The system shall display formatting change suggestions in a git-style diff format, color-coded when possible, to clearly show what modifications will be or have been made to the documents.

#### Relations
  * derivedFrom: [Formatting Output](../../UserRequirements.md#formatting-output)
  * satisfiedBy: [format.rs](../../../core/src/format.rs)
  * verifiedBy: [Format Command Requirements Verification](../../Verifications/Misc.md#format-command-requirements-verification)
---

### File Pattern Exclusion for Format

The system shall respect configured excluded filename patterns when performing formatting operations, ensuring that files intentionally excluded from processing do not receive inappropriate formatting suggestions.

#### Relations
  * derivedFrom: [Ignoring Unstructured Documents](../Storage/Configuration.md#ignoring-unstructured-documents)
  * satisfiedBy: [utils.rs](../../../core/src/utils.rs)
---

### Document Structure Normalization

When parsing documents, the system shall normalize document by adding missing page headers and section headers to ensure all documents follow a consistent hierarchical structure.

#### Details
When parsing  documents, the system shall:
- Add a level 1 page header based on the filename when document lacks a page header (does not start with `# `)
- Add a default section header `## Requirements` when elements exist without an explicit section header
- Preserve existing page headers when present (starting with `# `)
- Preserve existing section headers when present (starting with `## `)
- Correctly distinguish between level 1 headers (`# `) and level 2 or deeper headers (`##`, `###`)

**Default Header Names:**
- Page header: Derived from filename (e.g., "User Requirements" from "UserRequirements.md")
- Section header: "Requirements" (the default section name used by parser)

**Normalization Rules:**
1. If document starts with `###` element (no `#` and no `##`): Add both page header and section header
2. If document starts with `#` then `###` (no `##`): Add section header only
3. If document starts with `##` (no `#`): Add page header only
4. If document has both `#` and `##`: No header additions needed

#### Relations
  * derivedFrom: [Format Consistency Enforcement](../../UserRequirements.md#format-consistency-enforcement)
  * satisfiedBy: [graph_registry.rs](../../../core/src/graph_registry.rs)
  * satisfiedBy: [parser.rs](../../../core/src/parser.rs)
---