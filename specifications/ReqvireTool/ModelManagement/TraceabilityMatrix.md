# Traceability Matrix

## Traceability Matrix Implementation
```mermaid
graph LR;
  %% REQVIRE-AUTOGENERATED-DIAGRAM
  %% Graph styling
  classDef userRequirement fill:#f9d6d6,stroke:#f55f5f,stroke-width:1px;
  classDef systemRequirement fill:#fce4e4,stroke:#e68a8a,stroke-width:1px;
  classDef verification fill:#d6f9d6,stroke:#5fd75f,stroke-width:1px;
  classDef default fill:#f5f5f5,stroke:#333333,stroke-width:1px;

  9b11fef975b4c01f["CLI Matrix JSON Flag"];
  class 9b11fef975b4c01f systemRequirement;
  click 9b11fef975b4c01f "TraceabilityMatrix.md#cli-matrix-json-flag";
  16bf75b57622c10["matrix_generator.rs"];
  class 16bf75b57622c10 default;
  click 16bf75b57622c10 "../../../core/src/matrix_generator.rs";
  9b11fef975b4c01f -->|satisfiedBy| 16bf75b57622c10;
  50c290277850dd17["JSON Matrix Output Test"];
  class 50c290277850dd17 verification;
  click 50c290277850dd17 "../../Verifications/TreacibilityMatrix.md#json-matrix-output-test";
  9b11fef975b4c01f -.->|verifiedBy| 50c290277850dd17;
  10a344acecc49881["CLI Matrix SVG Flag"];
  class 10a344acecc49881 systemRequirement;
  click 10a344acecc49881 "TraceabilityMatrix.md#cli-matrix-svg-flag";
  16bf75b57622c10["matrix_generator.rs"];
  class 16bf75b57622c10 default;
  click 16bf75b57622c10 "../../../core/src/matrix_generator.rs";
  10a344acecc49881 -->|satisfiedBy| 16bf75b57622c10;
  62b41611d85d4161["SVG Matrix Output Test"];
  class 62b41611d85d4161 verification;
  click 62b41611d85d4161 "../../Verifications/TreacibilityMatrix.md#svg-matrix-output-test";
  10a344acecc49881 -.->|verifiedBy| 62b41611d85d4161;
  c02a614c9331efc2["Markdown Matrix Formatter"];
  class c02a614c9331efc2 systemRequirement;
  click c02a614c9331efc2 "TraceabilityMatrix.md#markdown-matrix-formatter";
  16bf75b57622c10["matrix_generator.rs"];
  class 16bf75b57622c10 default;
  click 16bf75b57622c10 "../../../core/src/matrix_generator.rs";
  c02a614c9331efc2 -->|satisfiedBy| 16bf75b57622c10;
  c02a614c9331efc2 -.->|verifiedBy| 50c290277850dd17;
  66ef5ed834d0b401["Traceability Matrix Builder Implementation"];
  class 66ef5ed834d0b401 systemRequirement;
  click 66ef5ed834d0b401 "TraceabilityMatrix.md#traceability-matrix-builder-implementation";
  16bf75b57622c10["matrix_generator.rs"];
  class 16bf75b57622c10 default;
  click 16bf75b57622c10 "../../../core/src/matrix_generator.rs";
  66ef5ed834d0b401 -->|satisfiedBy| 16bf75b57622c10;
  5a25cf6244f4f44["Hierarchical Matrix Format Test"];
  class 5a25cf6244f4f44 verification;
  click 5a25cf6244f4f44 "../../Verifications/TreacibilityMatrix.md#hierarchical-matrix-format-test";
  66ef5ed834d0b401 -.->|verifiedBy| 5a25cf6244f4f44;
  aa85c85e7c41d899["Traceability Matrix Generation Test"];
  class aa85c85e7c41d899 verification;
  click aa85c85e7c41d899 "../../Verifications/TreacibilityMatrix.md#traceability-matrix-generation-test";
  66ef5ed834d0b401 -.->|verifiedBy| aa85c85e7c41d899;
  7dde285bfbab3efc["CLI Matrix Command"];
  class 7dde285bfbab3efc systemRequirement;
  click 7dde285bfbab3efc "../UserInterface/CLI.md#cli-matrix-command";
  7dde285bfbab3efc -.->|deriveReqT| 9b11fef975b4c01f;
  7dde285bfbab3efc -.->|deriveReqT| 10a344acecc49881;
  80defdd4cbc7ee18["cli.rs"];
  class 80defdd4cbc7ee18 default;
  click 80defdd4cbc7ee18 "../../../cli/src/cli.rs";
  7dde285bfbab3efc -->|satisfiedBy| 80defdd4cbc7ee18;
  16bf75b57622c10["matrix_generator.rs"];
  class 16bf75b57622c10 default;
  click 16bf75b57622c10 "../../../core/src/matrix_generator.rs";
  7dde285bfbab3efc -->|satisfiedBy| 16bf75b57622c10;
  34c75e4a88e1f381["CLI Help Structure Verification"];
  class 34c75e4a88e1f381 verification;
  click 34c75e4a88e1f381 "../../Verifications/Misc.md#cli-help-structure-verification";
  7dde285bfbab3efc -.->|verifiedBy| 34c75e4a88e1f381;
  7dde285bfbab3efc -.->|verifiedBy| aa85c85e7c41d899;
  4e30ea0930dc9c26["Traceability Matrix"];
  class 4e30ea0930dc9c26 userRequirement;
  click 4e30ea0930dc9c26 "../../UserRequirements.md#traceability-matrix";
  4e30ea0930dc9c26 -.->|deriveReqT| c02a614c9331efc2;
  4e30ea0930dc9c26 -.->|deriveReqT| 66ef5ed834d0b401;
  7de9a55d6102af23["Export Traceability Matrix"];
  class 7de9a55d6102af23 userRequirement;
  click 7de9a55d6102af23 "../../UserRequirements.md#export-traceability-matrix";
  4e30ea0930dc9c26 -.->|deriveReqT| 7de9a55d6102af23;
  6d32b919c82784b7["Include Verification Checkboxes"];
  class 6d32b919c82784b7 userRequirement;
  click 6d32b919c82784b7 "../../UserRequirements.md#include-verification-checkboxes";
  4e30ea0930dc9c26 -.->|deriveReqT| 6d32b919c82784b7;
  11c3285e74c8d60b["Traceability Matrix Verification"];
  class 11c3285e74c8d60b verification;
  click 11c3285e74c8d60b "../../Verifications/ChangeImpactTests.md#traceability-matrix-verification";
  4e30ea0930dc9c26 -.->|verifiedBy| 11c3285e74c8d60b;
```
### Traceability Matrix Builder Implementation

The system shall implement a traceability matrix builder component that extracts relationship data from the model, processes it according to configured parameters, and generates structured matrix representations showing connections between requirements and other elements.

#### Details
The traceability matrix shall be organized into multiple tables, with one table per root requirement (requirements without parents). This organization improves readability by grouping related requirements together.

Each table shall have the following structure:
- The first column shows the requirement name as a markdown link to its location in the git repository using the current commit hash
- Requirements shall be displayed in a hierarchical structure with parent-child relationships clearly indicated
- Child requirements shall be indented to show their relationship to parent requirements using arrow and underscore characters:
  - Level 1 (direct children): "↳ " (right arrow followed by a space)
  - Level 2 (grandchildren): "__↳ " (two underscores, then arrow and space)
  - Level 3 (great-grandchildren): "____↳ " (four underscores, then arrow and space)
  - Deeper levels: "______↳ " (six underscores, then arrow and space)
- The second column shows the verification status with a green checkmark "✅" if verified by at least one verification element, or "❌" if not verified
- The subsequent columns represent individual verification elements that verify requirements in this group, with each element name displayed as a markdown link to its location in the git repository
- Each row represents a requirement within the group
- Cell intersections show the relationship between requirements and verifications with a green checkmark "✅" where a relationship exists or empty where no relationship exists
- The matrix shall be rendered as a markdown table for human readability
- The JSON format shall be available for machine processing with all identifiers relative to the repository root

The links in the matrix shall use the git repository URL with the current commit hash to ensure that links remain stable even as the repository evolves. The format shall be similar to that used in the change impact report.

#### Relations
  * derivedFrom: [Traceability Matrix](../../UserRequirements.md#traceability-matrix)
  * satisfiedBy: [matrix_generator.rs](../../../core/src/matrix_generator.rs)
---

### Markdown Matrix Formatter

The system shall implement a markdown formatter for traceability matrices that produces well-structured, readable markdown tables conforming to the Reqvire markdown-first methodology.

#### Relations
  * derivedFrom: [Traceability Matrix](../../UserRequirements.md#traceability-matrix)
  * satisfiedBy: [matrix_generator.rs](../../../core/src/matrix_generator.rs)
---

### CLI Matrix JSON Flag

The system shall provide a JSON output option for verification traceability matrices, activated by the `--json` command option flag when used with `matrix` command.

#### Details
The JSON output shall:
- Only be available when the `matrix` command is used
- Cannot be used together with the --svg command option flag (they are mutually exclusive)
- Include metadata about sources and targets
- Include matrix data mapping source requirements to target verifications
- Include verification status for each requirement using [Verification Roll-up Strategy](#verification-roll-up-strategy)
- Provide structured data suitable for programmatic processing

#### Relations
  * derivedFrom: [CLI Matrix Command](../UserInterface/CLI.md#cli-matrix-command)
  * satisfiedBy: [matrix_generator.rs](../../../core/src/matrix_generator.rs)
  * verifiedBy: [JSON Matrix Output Test](../../Verifications/TreacibilityMatrix.md#json-matrix-output-test)
---

### CLI Matrix SVG Flag

The system shall provide an SVG output option for verification traceability matrices, activated by the `--svg` command option flag when used with `matrix` command, which shall generate a simplified SVG representation of the matrix that can be viewed directly or embedded in documents.

#### Details
The SVG output of the verification traceability matrix shall have the following characteristics:
- It shall only be available when the `matrix` command is used
- It cannot be used together with the --json command option flag (they are mutually exclusive)
- It shall display full element names instead of truncated names with ellipses
- It shall dynamically adjust column widths based on the maximum element name length to ensure all text is readable
- It shall not include hyperlinks to elements in the git repository
- It shall maintain the same hierarchical structure as the markdown version
- It shall use visual indicators for verification status following [Verification Roll-up Strategy](#verification-roll-up-strategy)
- Verification columns shall be sorted alphabetically by verification identifier for deterministic output
- The output shall be in a self-contained SVG format suitable for embedding in other documents

#### Relations
  * derivedFrom: [CLI Matrix Command](../UserInterface/CLI.md#cli-matrix-command)
  * satisfiedBy: [matrix_generator.rs](../../../core/src/matrix_generator.rs)
  * verifiedBy: [SVG Matrix Output Test](../../Verifications/TreacibilityMatrix.md#svg-matrix-output-test)
---

## Verification Traceability
```mermaid
graph LR;
  %% REQVIRE-AUTOGENERATED-DIAGRAM
  %% Graph styling
  classDef userRequirement fill:#f9d6d6,stroke:#f55f5f,stroke-width:1px;
  classDef systemRequirement fill:#fce4e4,stroke:#e68a8a,stroke-width:1px;
  classDef verification fill:#d6f9d6,stroke:#5fd75f,stroke-width:1px;
  classDef default fill:#f5f5f5,stroke:#333333,stroke-width:1px;

  105876a11005743e["Verification Roll-up Strategy"];
  class 105876a11005743e systemRequirement;
  click 105876a11005743e "TraceabilityMatrix.md#verification-roll-up-strategy";
  b559b1f7629a5c62["CLI Coverage Command"];
  class b559b1f7629a5c62 systemRequirement;
  click b559b1f7629a5c62 "../UserInterface/CLI.md#cli-coverage-command";
  105876a11005743e -.->|deriveReqT| b559b1f7629a5c62;
  7dde285bfbab3efc["CLI Matrix Command"];
  class 7dde285bfbab3efc systemRequirement;
  click 7dde285bfbab3efc "../UserInterface/CLI.md#cli-matrix-command";
  105876a11005743e -.->|deriveReqT| 7dde285bfbab3efc;
  16bf75b57622c10["matrix_generator.rs"];
  class 16bf75b57622c10 default;
  click 16bf75b57622c10 "../../../core/src/matrix_generator.rs";
  105876a11005743e -->|satisfiedBy| 16bf75b57622c10;
  b93eaa92690c6c43["Verification Trace Builder"];
  class b93eaa92690c6c43 systemRequirement;
  click b93eaa92690c6c43 "TraceabilityMatrix.md#verification-trace-builder";
  7d29669df287de3a["CLI Traces Command"];
  class 7d29669df287de3a systemRequirement;
  click 7d29669df287de3a "../UserInterface/CLI.md#cli-traces-command";
  b93eaa92690c6c43 -.->|deriveReqT| 7d29669df287de3a;
  345c1bb921bc8a5["Maybe-Redundant Hierarchical Relations Detection"];
  class 345c1bb921bc8a5 systemRequirement;
  click 345c1bb921bc8a5 "../ValidationAndReporting/Lint.md#maybe-redundant-hierarchical-relations-detection";
  b93eaa92690c6c43 -.->|deriveReqT| 345c1bb921bc8a5;
  4517ba9864214f8f["Redundant Verify Relations Detection"];
  class 4517ba9864214f8f systemRequirement;
  click 4517ba9864214f8f "../ValidationAndReporting/Lint.md#redundant-verify-relations-detection";
  b93eaa92690c6c43 -.->|deriveReqT| 4517ba9864214f8f;
  7ceb6b9bed1a94e1["Verification Upward Traceability"];
  class 7ceb6b9bed1a94e1 userRequirement;
  click 7ceb6b9bed1a94e1 "../../UserRequirements.md#verification-upward-traceability";
  7ceb6b9bed1a94e1 -.->|deriveReqT| 105876a11005743e;
  7ceb6b9bed1a94e1 -.->|deriveReqT| b93eaa92690c6c43;
```
### Verification Trace Builder

The system shall provide functionality to build upward trace trees from verification elements by traversing all upward parent relations to reach root requirements, merging all paths into a single tree structure with marked directly-verified requirements.

#### Relations
  * derivedFrom: [Verification Upward Traceability](../../UserRequirements.md#verification-upward-traceability)
---

### Verification Roll-up Strategy

The system shall implement a verification roll-up strategy where parent requirements are considered verified based on the verification status of their child requirements.

#### Details
The roll-up strategy shall work as follows:
- When a requirement has children (through derivedFrom relations), it is considered verified if ALL of its child requirements are verified, regardless of whether the parent has direct verifiedBy relations
- When a requirement has no children (leaf requirement), it is considered verified if it has direct verifiedBy relations
- A parent with any unverified child shall be marked as unverified (❌), even if the parent itself has direct verification
- Verification status rolls up from leaf requirements through the entire parent chain to root requirements
- This strategy applies to all verification matrices, coverage reports, and trace outputs

#### Relations
  * derivedFrom: [Verification Upward Traceability](../../UserRequirements.md#verification-upward-traceability)
  * satisfiedBy: [matrix_generator.rs](../../../core/src/matrix_generator.rs)
---